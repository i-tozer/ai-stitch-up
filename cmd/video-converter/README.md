# Video Converter Tool

This tool converts images to videos using the Runway ML API. It supports both a Go implementation and a Node.js implementation using the official RunwayML SDK.

## Features

- Converts static images into 10-second video clips (configurable)
- Integrates with Runway ML's Gen-3 Alpha Turbo API for high-quality video generation
- Supports batch processing of multiple images
- Provides detailed logging of the conversion process
- Falls back to placeholder videos when no API key is provided (for testing)

## Prerequisites

- Go 1.18 or later
- For Node.js implementation:
  - Node.js 18 or later
  - NPM
- Input images (typically generated by the Image Creator tool)

## Installation

Build the tool using Go:

```bash
go build -o bin/video-converter cmd/video-converter/main.go
```

If using the Node.js implementation, the tool will automatically install the required Node.js dependencies when first run.

## Configuration

Create a `.env` file in the project root with your Runway ML API key:

```
RUNWAY_API_KEY=your_api_key_here
```

## Usage

```bash
./bin/video-converter [options]
```

### Options

- `--input-dir <dir>`: Directory containing input images (default: "output/images")
- `--output-dir <dir>`: Directory for output videos (default: "output/videos")
- `--video-length <seconds>`: Length of generated videos in seconds (default: 10)
- `--runway-api-key <key>`: Runway ML API key (defaults to RUNWAY_API_KEY from .env file)
- `--use-node <bool>`: Use Node.js implementation (default: true)

### Example

```bash
./bin/video-converter --input-dir output/images --output-dir output/videos --video-length 5
```

## API Workflow

The tool uses the Runway ML API to convert images to videos. The workflow is as follows:

1. Images are loaded from the input directory
2. For each image:
   - The image is converted to base64
   - A request is sent to the Runway ML API
   - The tool polls for job completion
   - The video is downloaded and saved to the output directory
3. A `videos.json` file is created in the output directory with metadata about the generated videos

### Node.js Implementation

When using the Node.js implementation (`--use-node=true`), the tool uses the official RunwayML SDK to interact with the API. This implementation:

- Uses the official SDK for better reliability and compatibility
- Handles authentication, retries, and error handling automatically
- Provides better logging and debugging information

### Go Implementation

When using the Go implementation (`--use-node=false`), the tool uses a custom Go implementation to interact with the API. This implementation:

- Has no external dependencies beyond the Go standard library
- May be more performant in some cases
- Is maintained as a fallback option

## Output

The tool generates:

1. Video files in the output directory
2. A `videos.json` file with metadata about the generated videos

The `videos.json` file contains an array of objects with the following properties:

```json
[
  {
    "path": "path/to/video.mp4",
    "imageID": "scene_id",
    "length": 10
  }
]
```

## Integration with Stitch-Up

This tool is part of the Stitch-Up pipeline. It takes images generated from scene descriptions and converts them to videos, which can then be assembled into a final video.

## Environment Variables

The tool looks for the following environment variables in a `.env` file:

- `RUNWAY_API_KEY`: Your Runway ML API key

## How It Works

1. The tool scans the input directory for image files
2. For each image, it:
   - Reads the image file
   - Sends the image to Runway ML's API with the scene description
   - Monitors the generation process
   - Downloads the completed video
   - Saves the video to the output directory
3. The tool logs the progress and results of the conversion process

## API Integration

The tool integrates with Runway ML's image-to-video API using the Gen-3 Alpha Turbo model. The API workflow is as follows:

1. The image is encoded as a base64 data URI
2. A request is sent to the `https://api.dev.runwayml.com/v1/image_to_video` endpoint
3. The request includes:
   - `promptImage`: Base64-encoded image data URI
   - `promptText`: Description of the scene
   - `model`: Set to "gen3a_turbo"
4. The API returns a job ID which is used to poll for the result
5. Once the job is completed, the video is downloaded and saved

The API headers include:
- `Content-Type: application/json`
- `Authorization: Bearer <API_KEY>`
- `X-Runway-Version: 2024-11-06`

## Troubleshooting

- If no API key is provided, the tool will generate placeholder videos
- If the API returns an error, the tool will log the error and continue with the next image
- If no images are found in the input directory, the tool will exit with an error 